parents:
  - module: cluster
    profile: aws-network

config:
  kube_node_subnet_cidr_prefix: 20
  kube_node_subnet_public_ip: true

  aws_kube_node_subnets:
    - kube_node_1
    - kube_node_2

  aws_kube_node_machine: t2.medium
  aws_kube_node_tenancy: default
  aws_kube_node_monitoring: false
  aws_kube_node_ebs_type: gp2
  aws_kube_node_ebs_size: 10
  aws_kube_node_ebs_iops: null
  aws_kube_node_ebs_optimized: false
  aws_kube_node_ebs_encrypted: false

  kube_node_nodeport_port_low: 30000
  kube_node_nodeport_port_high: 32767

group:
  kube-node:

subnet:
  kube_node_1:
    when_in: "@aws_kube_node_subnets"
    network: "@aws_networks"
    cidr_prefix: "@kube_node_subnet_cidr_prefix"
    zone_suffix: a
    use_public_ip: "@kube_node_subnet_public_ip"
    groups: kube-node

  kube_node_2:
    when_in: "@aws_kube_node_subnets"
    network: "@aws_networks"
    cidr_prefix: "@kube_node_subnet_cidr_prefix"
    zone_suffix: b
    use_public_ip: "@kube_node_subnet_public_ip"
    groups: kube-node

firewall:
  kube_node_internal:
    network: "@aws_networks"
    groups: kube-node
    rules:
      nodeport_in:
        mode: ingress
        protocol: tcp
        from_port: "@kube_node_nodeport_port_low"
        to_port: "@kube_node_nodeport_port_high"
        self_only: true

server:
  kube_node:
    count: 5
    provider: ec2
    network: "@aws_networks"
    subnet: "@aws_kube_node_subnets"
    image: "@aws_ubuntu_image[<network>]"
    ssh_port: "@ssh_port"
    user: "@aws_ubuntu_user"
    machine: "@aws_kube_node_machine"
    tenancy: "@aws_kube_node_tenancy"
    monitoring: "@aws_kube_node_monitoring"
    ebs_type: "@aws_kube_node_ebs_type"
    ebs_size: "@aws_kube_node_ebs_size"
    ebs_iops: "@aws_kube_node_ebs_iops"
    ebs_iops: "@aws_kube_node_ebs_iops"
    ebs_optimized: "@aws_kube_node_ebs_optimized"
    ebs_encrypted: "@aws_kube_node_ebs_encrypted"
    groups: kube-node
    firewalls:
      - internet
      - ssh_external
      - kubelet_internal
      - kube_node_internal
      - weave_internal
