parents:
  - module: cluster
    profile: aws-domain

  - module: cluster
    profile: aws-network

  - aws-groups

config:
  kubelet_port: 10250
  kubelet_ro_port: 10255

  etcd_port_low: 2379
  etcd_port_high: 2380

  weave_port_low: 6783
  weave_port_high: 6784

domain:
  "@root_domain":
    certificate_authority: letsencrypt

certificate:
  kube:
    provider: aws
    network: "@aws_networks"
    domain: "@root_domain"
    groups: k8s-cluster

firewall:
  kubelet_internal:
    network: "@aws_networks"
    groups: k8s-cluster
    rules:
      kubelet_in:
        mode: ingress
        protocol: tcp
        from_port: "@kubelet_port"
        to_port: "@kubelet_port"
        self_only: true
      kubelet_ro_in:
        mode: ingress
        protocol: tcp
        from_port: "@kubelet_ro_port"
        to_port: "@kubelet_ro_port"
        self_only: true

  etcd_internal:
    network: "@aws_networks"
    groups:
      - etcd
      - k8s-cluster
    rules:
      tcp_in:
        mode: ingress
        protocol: tcp
        from_port: "@etcd_port_low"
        to_port: "@etcd_port_high"
        self_only: true

  weave_internal:
    network: "@aws_networks"
    groups:
      - weave
      - k8s-cluster
    rules:
      tcp_in:
        mode: ingress
        protocol: tcp
        from_port: "@weave_port_low"
        to_port: "@weave_port_high"
        self_only: true
